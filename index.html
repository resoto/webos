<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS v5.0 - Minesweeper Edition</title>
    <style>
        /* --- Reset & Variables --- */
        :root {
            --bg-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1920&q=80');
            --window-bg: #c0c0c0; /* Classic Gray */
            --header-bg: #000080; /* Classic Blue Title */
            --header-text: white;
            --taskbar-height: 40px;
        }
        * { box-sizing: border-box; user-select: none; }
        body { margin: 0; padding: 0; font-family: "Tahoma", "Segoe UI", sans-serif; overflow: hidden; height: 100vh; width: 100vw; background: #000; }

        /* --- Layers --- */
        .layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: 0.5s; }
        
        /* Boot Screen */
        #boot-screen {
            background: black; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid #333; border-top: 5px solid #0078d7; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Lock Screen */
        #lock-screen {
            background: var(--bg-image) center/cover no-repeat; z-index: 20000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #lock-screen.unlocked { transform: translateY(-100%); }
        .time-large { font-size: 6rem; font-weight: 300; margin: 0; }
        .login-btn { padding: 10px 40px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(10px); cursor: pointer; border-radius: 30px; font-size: 1rem; }

        /* Desktop */
        #desktop { background: var(--bg-image) center/cover no-repeat; z-index: 1; overflow: hidden; }
        
        .desktop-icons {
            padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); 
            grid-auto-rows: minmax(100px, auto); gap: 15px; 
            height: calc(100% - var(--taskbar-height)); align-content: start;
        }
        .icon {
            width: 100%; max-width: 100px; padding: 15px 10px; text-align: center; color: white; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            border-radius: 8px; cursor: pointer; border: 1px solid transparent; transition: all 0.2s ease;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .icon:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); }
        .icon-emoji { font-size: 3rem; display: block; margin-bottom: 8px; }

        /* Windows (Retro Style) */
        .window {
            position: absolute; background: var(--window-bg); 
            border: 2px solid; border-color: #dfdfdf #404040 #404040 #dfdfdf;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5); display: flex; flex-direction: column;
            min-width: 200px; min-height: 150px; max-width: 95vw; max-height: 90vh;
            overflow: hidden;
            opacity: 0; transform: scale(0.95); transition: opacity 0.1s, transform 0.1s;
            pointer-events: none; 
        }
        .window.active { opacity: 1; transform: scale(1); pointer-events: auto; }
        .window.minimized { opacity: 0; transform: translateY(200px) scale(0.5); pointer-events: none; }

        .win-header {
            background: var(--header-bg); color: var(--header-text);
            padding: 2px 4px; height: 28px; display: flex; align-items: center; justify-content: space-between;
            font-weight: bold; font-size: 13px;
        }
        .win-actions { display: flex; gap: 2px; }
        .win-btn { 
            width: 20px; height: 20px; border: 1px solid; border-color: #dfdfdf #404040 #404040 #dfdfdf;
            background: #c0c0c0; font-size: 12px; line-height: 1; display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .win-btn:active { border-color: #404040 #dfdfdf #dfdfdf #404040; }
        .win-btn.close { font-family: monospace; font-weight: bold; }

        .win-content { flex: 1; position: relative; background: white; overflow: hidden; }

        /* Minesweeper Styles */
        .ms-outer { background: #c0c0c0; padding: 10px; height: 100%; display: flex; flex-direction: column; align-items: center; }
        .ms-header {
            border: 2px solid; border-color: #808080 #fff #fff #808080;
            width: 100%; padding: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; background: #c0c0c0;
        }
        .ms-counter {
            background: black; color: red; font-family: "Courier New", monospace; font-size: 20px; font-weight: bold;
            padding: 0 2px; border: 1px solid #808080; width: 40px; text-align: center;
        }
        .ms-face {
            width: 26px; height: 26px; font-size: 18px; cursor: pointer;
            border: 2px solid; border-color: #fff #808080 #808080 #fff; background: #c0c0c0;
            display: flex; align-items: center; justify-content: center; padding-bottom: 2px;
        }
        .ms-face:active { border-color: #808080 #fff #fff #808080; padding-top: 2px; padding-bottom: 0; }
        
        .ms-grid {
            display: grid; grid-template-columns: repeat(9, 25px); grid-template-rows: repeat(9, 25px);
            border: 3px solid; border-color: #808080 #fff #fff #808080;
        }
        .ms-cell {
            width: 25px; height: 25px; background: #c0c0c0;
            border: 2px solid; border-color: #fff #808080 #808080 #fff;
            font-weight: bold; font-size: 14px; display: flex; align-items: center; justify-content: center;
            cursor: default;
        }
        .ms-cell.revealed {
            border: 1px solid #808080; background: #c0c0c0;
        }
        .ms-cell.bomb-revealed { background: red; border: 1px solid #808080; }
        
        /* Numbers Colors */
        .ms-c1 { color: blue; } .ms-c2 { color: green; } .ms-c3 { color: red; } .ms-c4 { color: navy; }
        .ms-c5 { color: maroon; } .ms-c6 { color: teal; } .ms-c7 { color: black; } .ms-c8 { color: gray; }

        /* Browser Iframe */
        .browser-nav { display: flex; gap: 5px; padding: 5px; background: #c0c0c0; border-bottom: 1px solid #888; }
        .iframe-blocker { position: absolute; top:0; left:0; width:100%; height:100%; display: none; }

        /* Taskbar */
        #taskbar {
            position: absolute; bottom: 0; left: 0; width: 100%; height: var(--taskbar-height);
            background: #c0c0c0; border-top: 2px solid #fff;
            display: flex; align-items: center; padding: 2px; z-index: 10000;
        }
        .start-btn {
            height: 32px; padding: 0 10px; display: flex; align-items: center; gap: 5px;
            border: 2px solid; border-color: #fff #404040 #404040 #fff;
            font-weight: bold; font-style: italic; cursor: pointer; margin-right: 5px;
        }
        .start-btn:active { border-color: #404040 #fff #fff #404040; transform: translateY(1px); }
        
        .task-container { flex: 1; display: flex; gap: 2px; padding-left: 5px; }
        .task-item {
            min-width: 120px; max-width: 200px; background: #c0c0c0; border: 2px solid; border-color: #fff #404040 #404040 #fff;
            padding: 4px 8px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 1;
        }
        .task-item.active-task {
            background: #e0e0e0; border-color: #404040 #fff #fff #404040; background-image: linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 50%, #ddd 50%, #ddd 75%, transparent 75%, transparent); background-size: 4px 4px;
        }

        .sys-tray { margin-left: auto; padding: 0 10px; font-size: 12px; border: 2px solid; border-color: #808080 #fff #fff #808080; background: #c0c0c0; height: 30px; display: flex; align-items: center; }

        /* Start Menu */
        #start-menu {
            position: fixed; bottom: 42px; left: 2px; width: 220px; background: #c0c0c0;
            border: 2px solid; border-color: #fff #404040 #404040 #fff; padding: 2px; z-index: 10001;
            display: none; flex-direction: column; max-height: calc(100vh - 50px);
        }
        #start-menu.open { display: flex; }
        .menu-row { padding: 12px 10px; display: flex; align-items: center; gap: 10px; cursor: pointer; transition: background 0.1s; }
        .menu-row:hover { background: #000080; color: white; }

        /* Calculator Styles */
        .calc-container { background: #c0c0c0; padding: 10px; height: 100%; display: flex; flex-direction: column; }
        .calc-display {
            background: black; color: #00ff00; font-family: "Courier New", monospace; font-size: 24px;
            padding: 10px; text-align: right; border: 2px inset; margin-bottom: 10px; min-height: 40px;
        }
        .calc-buttons {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; flex: 1;
        }
        .calc-btn {
            background: #e0e0e0; border: 2px outset; padding: 15px; font-size: 16px; cursor: pointer;
            font-weight: bold; transition: all 0.1s;
        }
        .calc-btn:active { border: 2px inset; }
        .calc-btn.operator { background: #ffa500; }
        .calc-btn.equals { background: #0080ff; color: white; }
        .calc-btn.clear { background: #ff4444; color: white; }

        /* Clock Styles */
        .clock-container { padding: 20px; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #c0c0c0; }
        .clock-display { font-size: 4rem; font-weight: bold; margin: 20px 0; font-family: "Courier New", monospace; }
        .date-display { font-size: 1.5rem; margin-bottom: 30px; }
        .alarm-section { width: 100%; padding: 20px; border: 2px inset; background: white; }
        .alarm-input { padding: 5px; margin: 5px; width: 60px; border: 1px solid #888; }
        .alarm-list { margin-top: 10px; max-height: 150px; overflow-y: auto; }

        /* Paint Styles */
        .paint-toolbar {
            background: #c0c0c0; padding: 5px; border-bottom: 1px solid #888; display: flex; gap: 5px; flex-wrap: wrap;
        }
        .paint-btn {
            padding: 5px 10px; border: 2px outset; background: #e0e0e0; cursor: pointer; font-size: 12px;
        }
        .paint-btn:active { border: 2px inset; }
        .paint-canvas-container { flex: 1; position: relative; overflow: auto; background: white; }
        .paint-canvas { border: 1px solid #888; cursor: crosshair; display: block; }

        /* Calendar Styles */
        .calendar-container { padding: 10px; height: 100%; background: white; }
        .calendar-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;
            padding: 5px; background: #c0c0c0; border: 2px inset;
        }
        .calendar-nav-btn { padding: 5px 15px; border: 2px outset; background: #e0e0e0; cursor: pointer; }
        .calendar-nav-btn:active { border: 2px inset; }
        .calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;
        }
        .calendar-day-header {
            background: #000080; color: white; padding: 5px; text-align: center; font-weight: bold; font-size: 12px;
        }
        .calendar-day {
            background: #f0f0f0; padding: 8px; text-align: center; cursor: pointer; border: 1px solid #ddd;
            min-height: 30px; display: flex; align-items: center; justify-content: center;
        }
        .calendar-day:hover { background: #e0e0e0; }
        .calendar-day.other-month { color: #999; }
        .calendar-day.today { background: #ffff00; font-weight: bold; }

        /* Stopwatch Styles */
        .stopwatch-container {
            padding: 30px; height: 100%; display: flex; flex-direction: column; align-items: center;
            justify-content: center; background: #c0c0c0;
        }
        .stopwatch-display {
            font-size: 5rem; font-family: "Courier New", monospace; font-weight: bold;
            margin: 30px 0; background: black; color: #00ff00; padding: 20px 40px; border: 3px inset;
        }
        .stopwatch-controls {
            display: flex; gap: 10px; margin-top: 20px;
        }
        .stopwatch-btn {
            padding: 10px 20px; border: 2px outset; background: #e0e0e0; cursor: pointer;
            font-size: 14px; font-weight: bold;
        }
        .stopwatch-btn:active { border: 2px inset; }
        .stopwatch-btn.start { background: #00ff00; }
        .stopwatch-btn.stop { background: #ff4444; color: white; }
        .stopwatch-btn.reset { background: #ffa500; }
        .stopwatch-laps {
            margin-top: 20px; max-height: 200px; overflow-y: auto; width: 100%;
            background: white; border: 2px inset; padding: 10px;
        }
    </style>
</head>
<body>

    <div id="boot-screen" class="layer">
        <div class="spinner"></div>
        <h2>WebOS v5.0</h2>
        <p>Minesweeper Edition</p>
    </div>

    <div id="lock-screen" class="layer" style="display:none;">
        <div class="time-large" id="lock-time">12:00</div>
        <button class="login-btn" onclick="unlockSystem()">Click to Login</button>
    </div>

    <div id="desktop" class="layer" style="display:none;">
        
        <div class="desktop-icons">
            <div class="icon" onclick="app.open('game')">
                <span class="icon-emoji">üí£</span>
                <span>„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë</span>
            </div>
            <div class="icon" onclick="app.open('browser')">
                <span class="icon-emoji">üåê</span>
                <span>„Éñ„É©„Ç¶„Ç∂</span>
            </div>
            <div class="icon" onclick="app.open('notepad')">
                <span class="icon-emoji">üìù</span>
                <span>„É°„É¢Â∏≥</span>
            </div>
            <div class="icon" onclick="app.open('settings')">
                <span class="icon-emoji">‚öôÔ∏è</span>
                <span>Ë®≠ÂÆö</span>
            </div>
            <div class="icon" onclick="app.open('calculator')">
                <span class="icon-emoji">üî¢</span>
                <span>Ë®àÁÆóÊ©ü</span>
            </div>
            <div class="icon" onclick="app.open('clock')">
                <span class="icon-emoji">üïê</span>
                <span>ÊôÇË®à</span>
            </div>
            <div class="icon" onclick="app.open('paint')">
                <span class="icon-emoji">üé®</span>
                <span>„Éö„Ç§„É≥„Éà</span>
            </div>
            <div class="icon" onclick="app.open('calendar')">
                <span class="icon-emoji">üìÖ</span>
                <span>„Ç´„É¨„É≥„ÉÄ„Éº</span>
            </div>
            <div class="icon" onclick="app.open('stopwatch')">
                <span class="icon-emoji">‚è±Ô∏è</span>
                <span>„Çπ„Éà„ÉÉ„Éó„Ç¶„Ç©„ÉÉ„ÉÅ</span>
            </div>
        </div>

        <div id="win-game" class="window" style="width: 300px; height: 380px; top: 10%; left: 10%;" data-title="„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-game')">
                <span>„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-game')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-game')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <div class="ms-outer" oncontextmenu="return false;">
                    <div class="ms-header">
                        <div class="ms-counter" id="ms-bomb-count">010</div>
                        <button class="ms-face" id="ms-face-btn" onclick="minesweeper.init()">üôÇ</button>
                        <div class="ms-counter" id="ms-timer">000</div>
                    </div>
                    <div id="ms-grid" class="ms-grid"></div>
                </div>
            </div>
        </div>

        <div id="win-browser" class="window" style="width: 80%; max-width: 900px; height: 70%; max-height: 700px; top: 5%; left: 10%;" data-title="„Éñ„É©„Ç¶„Ç∂">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-browser')">
                <span>Web Browser</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-browser')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-browser')">√ó</button>
                </div>
            </div>
            <div class="win-content" style="display:flex; flex-direction:column;">
                <div class="browser-nav">
                    <input type="text" id="browser-url" style="flex:1;" value="https://ja.m.wikipedia.org/wiki/Main_Page" onkeydown="if(event.key==='Enter') browser.go()">
                    <button onclick="browser.go()">Go</button>
                </div>
                <div style="flex:1; position:relative;">
                    <div class="iframe-blocker" id="browser-blocker"></div>
                    <iframe id="browser-frame" src="about:blank" style="width:100%; height:100%; border:none;"></iframe>
                </div>
            </div>
        </div>

        <div id="win-notepad" class="window" style="width: 400px; height: 350px; top: 15%; left: 15%;" data-title="„É°„É¢Â∏≥">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-notepad')">
                <span>ÁÑ°È°å - „É°„É¢Â∏≥</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-notepad')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-notepad')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <textarea style="width:100%; height:100%; resize:none; border:none; padding:5px;"></textarea>
            </div>
        </div>

        <div id="win-settings" class="window" style="width: 350px; height: 300px; top: 20%; left: 20%;" data-title="Ë®≠ÂÆö">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-settings')">
                <span>Ë®≠ÂÆö</span>
                <div class="win-actions"><button class="win-btn close" onclick="wm.close('win-settings')">√ó</button></div>
            </div>
            <div class="win-content" style="padding:10px;">
                <p>ËÉåÊôØË®≠ÂÆö:</p>
                <button onclick="document.documentElement.style.setProperty('--bg-image', 'url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e?auto=format&fit=crop&w=1920)')">Â±±</button>
                <button onclick="document.documentElement.style.setProperty('--bg-image', 'url(https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?auto=format&fit=crop&w=1920)')">ÈÉΩÂ∏Ç</button>
            </div>
        </div>

        <div id="win-calculator" class="window" style="width: 280px; height: 380px; top: 10%; left: 15%;" data-title="Ë®àÁÆóÊ©ü">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-calculator')">
                <span>Ë®àÁÆóÊ©ü</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-calculator')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-calculator')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <div class="calc-container">
                    <div class="calc-display" id="calc-display">0</div>
                    <div class="calc-buttons" id="calc-buttons"></div>
                </div>
            </div>
        </div>

        <div id="win-clock" class="window" style="width: 400px; height: 500px; top: 10%; left: 20%;" data-title="ÊôÇË®à">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-clock')">
                <span>ÊôÇË®à„Éª„Ç¢„É©„Éº„É†</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-clock')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-clock')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <div class="clock-container">
                    <div class="date-display" id="clock-date"></div>
                    <div class="clock-display" id="clock-time-display">00:00:00</div>
                    <div class="alarm-section">
                        <h3>„Ç¢„É©„Éº„É†Ë®≠ÂÆö</h3>
                        <div>
                            <input type="number" class="alarm-input" id="alarm-hour" min="0" max="23" value="12" placeholder="ÊôÇ">
                            <span>:</span>
                            <input type="number" class="alarm-input" id="alarm-minute" min="0" max="59" value="0" placeholder="ÂàÜ">
                            <button class="paint-btn" onclick="clockApp.addAlarm()">ËøΩÂä†</button>
                        </div>
                        <div class="alarm-list" id="alarm-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="win-paint" class="window" style="width: 600px; height: 500px; top: 5%; left: 10%;" data-title="„Éö„Ç§„É≥„Éà">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-paint')">
                <span>„Éö„Ç§„É≥„Éà</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-paint')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-paint')">√ó</button>
                </div>
            </div>
            <div class="win-content" style="display:flex; flex-direction:column;">
                <div class="paint-toolbar">
                    <button class="paint-btn" onclick="paintApp.clear()">„ÇØ„É™„Ç¢</button>
                    <input type="color" id="paint-color" value="#000000" onchange="paintApp.setColor(this.value)">
                    <input type="range" id="paint-size" min="1" max="20" value="5" oninput="paintApp.setSize(this.value)">
                    <span id="paint-size-display">5px</span>
                </div>
                <div class="paint-canvas-container">
                    <canvas id="paint-canvas" class="paint-canvas" width="550" height="400"></canvas>
                </div>
            </div>
        </div>

        <div id="win-calendar" class="window" style="width: 500px; height: 450px; top: 10%; left: 15%;" data-title="„Ç´„É¨„É≥„ÉÄ„Éº">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-calendar')">
                <span>„Ç´„É¨„É≥„ÉÄ„Éº</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-calendar')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-calendar')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" onclick="calendarApp.prevMonth()">‚Üê</button>
                        <span id="calendar-month-year" style="font-weight:bold; font-size:16px;"></span>
                        <button class="calendar-nav-btn" onclick="calendarApp.nextMonth()">‚Üí</button>
                    </div>
                    <div class="calendar-grid" id="calendar-grid"></div>
                </div>
            </div>
        </div>

        <div id="win-stopwatch" class="window" style="width: 400px; height: 400px; top: 15%; left: 20%;" data-title="„Çπ„Éà„ÉÉ„Éó„Ç¶„Ç©„ÉÉ„ÉÅ">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-stopwatch')">
                <span>„Çπ„Éà„ÉÉ„Éó„Ç¶„Ç©„ÉÉ„ÉÅ</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-stopwatch')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-stopwatch')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <div class="stopwatch-container">
                    <div class="stopwatch-display" id="stopwatch-display">00:00:00</div>
                    <div class="stopwatch-controls">
                        <button class="stopwatch-btn start" id="stopwatch-start" onclick="stopwatchApp.start()">ÈñãÂßã</button>
                        <button class="stopwatch-btn stop" id="stopwatch-stop" onclick="stopwatchApp.stop()" style="display:none;">ÂÅúÊ≠¢</button>
                        <button class="stopwatch-btn reset" onclick="stopwatchApp.reset()">„É™„Çª„ÉÉ„Éà</button>
                        <button class="stopwatch-btn" onclick="stopwatchApp.lap()">„É©„ÉÉ„Éó</button>
                    </div>
                    <div class="stopwatch-laps" id="stopwatch-laps"></div>
                </div>
            </div>
        </div>

        <div id="taskbar">
            <div class="start-btn" onclick="sys.toggleStart()">
                <span style="color:red; font-weight:900;">‚ùñ</span> Start
            </div>
            <div class="task-container" id="task-list"></div>
            <div class="sys-tray">
                <span id="clock">00:00</span>
            </div>
        </div>

        <div id="start-menu">
            <div class="menu-row" onclick="app.open('game'); sys.toggleStart()">üí£ „Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë</div>
            <div class="menu-row" onclick="app.open('browser'); sys.toggleStart()">üåê „Éñ„É©„Ç¶„Ç∂</div>
            <div class="menu-row" onclick="app.open('notepad'); sys.toggleStart()">üìù „É°„É¢Â∏≥</div>
            <div class="menu-row" onclick="app.open('calculator'); sys.toggleStart()">üî¢ Ë®àÁÆóÊ©ü</div>
            <div class="menu-row" onclick="app.open('clock'); sys.toggleStart()">üïê ÊôÇË®à</div>
            <div class="menu-row" onclick="app.open('paint'); sys.toggleStart()">üé® „Éö„Ç§„É≥„Éà</div>
            <div class="menu-row" onclick="app.open('calendar'); sys.toggleStart()">üìÖ „Ç´„É¨„É≥„ÉÄ„Éº</div>
            <div class="menu-row" onclick="app.open('stopwatch'); sys.toggleStart()">‚è±Ô∏è „Çπ„Éà„ÉÉ„Éó„Ç¶„Ç©„ÉÉ„ÉÅ</div>
            <div style="height:1px; background:#808080; margin:5px 0;"></div>
            <div class="menu-row" onclick="app.open('settings'); sys.toggleStart()">‚öôÔ∏è Ë®≠ÂÆö</div>
            <div style="height:1px; background:#808080; margin:5px 0;"></div>
            <div class="menu-row" onclick="sys.shutdown()">‚èª „Ç∑„É£„ÉÉ„Éà„ÉÄ„Ç¶„É≥</div>
        </div>

    </div>

    <script>
        /* --- SYSTEM --- */
        const sys = {
            boot: () => {
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    document.getElementById('lock-screen').style.display = 'flex';
                    sys.updateClock();
                }, 1500);
            },
            updateClock: () => {
                const now = new Date();
                const t = now.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
                document.getElementById('clock').textContent = t;
                document.getElementById('lock-time').textContent = t;
            },
            toggleStart: () => document.getElementById('start-menu').classList.toggle('open'),
            shutdown: () => {
                document.getElementById('desktop').style.filter='grayscale(1)';
                setTimeout(()=>location.reload(), 1000);
            }
        };
        setInterval(sys.updateClock, 1000);
        window.onload = sys.boot;
        function unlockSystem() {
            document.getElementById('lock-screen').classList.add('unlocked');
            document.getElementById('desktop').style.display = 'block';
        }

        /* --- WM --- */
        let zIndex = 100;
        const wm = {
            open: (id) => {
                const w = document.getElementById(id);
                w.classList.remove('minimized'); w.classList.add('active');
                wm.toFront(w);
                taskbar.add(id, w.dataset.title);
            },
            close: (id) => {
                document.getElementById(id).classList.remove('active');
                taskbar.remove(id);
                if(id==='win-game') minesweeper.reset();
            },
            minimize: (id) => {
                document.getElementById(id).classList.add('minimized');
                document.getElementById(id).classList.remove('active');
                taskbar.update(null);
            },
            toFront: (w) => {
                w.style.zIndex = ++zIndex;
                taskbar.update(w.id);
            },
            startDrag: (e, id) => {
                if(e.target.classList.contains('win-btn')) return;
                const w = document.getElementById(id);
                wm.toFront(w);
                if(id === 'win-browser') document.getElementById('browser-blocker').style.display='block';
                
                const r = w.getBoundingClientRect();
                const offX = e.clientX - r.left, offY = e.clientY - r.top;
                
                const move = (ev) => {
                    w.style.left = (ev.clientX - offX) + 'px';
                    w.style.top = Math.max(0, ev.clientY - offY) + 'px';
                };
                const stop = () => {
                    document.removeEventListener('mousemove', move);
                    document.removeEventListener('mouseup', stop);
                    if(id === 'win-browser') document.getElementById('browser-blocker').style.display='none';
                };
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', stop);
            }
        };
        document.querySelectorAll('.window').forEach(w=>w.addEventListener('mousedown',()=>wm.toFront(w)));

        /* --- TASKBAR --- */
        const taskbar = {
            add: (id, title) => {
                if(document.getElementById('task-'+id)) return;
                const el = document.createElement('div');
                el.id = 'task-'+id; el.className='task-item active-task';
                const icons = {
                    'win-game': 'üí£ ', 'win-browser': 'üåê ', 'win-notepad': 'üìù ',
                    'win-calculator': 'üî¢ ', 'win-clock': 'üïê ', 'win-paint': 'üé® ',
                    'win-calendar': 'üìÖ ', 'win-stopwatch': '‚è±Ô∏è ', 'win-settings': '‚öôÔ∏è '
                };
                el.innerHTML = (icons[id] || 'üìÑ ') + title;
                el.onclick = () => {
                    const w = document.getElementById(id);
                    if(w.classList.contains('active') && w.style.zIndex==zIndex) wm.minimize(id);
                    else wm.open(id);
                };
                document.getElementById('task-list').appendChild(el);
            },
            remove: (id) => { const el = document.getElementById('task-'+id); if(el) el.remove(); },
            update: (id) => {
                document.querySelectorAll('.task-item').forEach(t => t.classList.remove('active-task'));
                if(id) document.getElementById('task-'+id)?.classList.add('active-task');
            }
        };

        /* --- APPS --- */
        const app = {
            open: (name) => {
                wm.open('win-'+name);
                if(name==='browser') browser.init();
                if(name==='game') minesweeper.init();
                if(name==='calculator') calculator.init();
                if(name==='clock') clockApp.init();
                if(name==='paint') paintApp.init();
                if(name==='calendar') calendarApp.init();
                if(name==='stopwatch') stopwatchApp.init();
            }
        };
        const browser = {
            init: () => {
                const f = document.getElementById('browser-frame');
                if(f.src==='about:blank') f.src="https://ja.m.wikipedia.org/wiki/Main_Page";
            },
            go: () => {
                let u = document.getElementById('browser-url').value;
                if(!u.startsWith('http')) u = 'https://ja.m.wikipedia.org/w/index.php?search='+encodeURIComponent(u);
                document.getElementById('browser-frame').src = u;
            }
        };

        /* --- MINESWEEPER LOGIC --- */
        const minesweeper = {
            rows: 9, cols: 9, bombCount: 10,
            grid: [], bombs: [], revealed: [], flagged: [],
            gameOver: false, timer: 0, timerInt: null,

            init: () => {
                const ms = minesweeper;
                ms.gameOver = false;
                ms.grid = document.getElementById('ms-grid');
                ms.grid.innerHTML = '';
                ms.bombs = Array(ms.rows * ms.cols).fill(false);
                ms.revealed = Array(ms.rows * ms.cols).fill(false);
                ms.flagged = Array(ms.rows * ms.cols).fill(false);
                document.getElementById('ms-face-btn').textContent = 'üôÇ';
                document.getElementById('ms-bomb-count').textContent = ms.pad(ms.bombCount);
                
                // Place bombs
                let placed = 0;
                while(placed < ms.bombCount) {
                    let idx = Math.floor(Math.random() * (ms.rows * ms.cols));
                    if(!ms.bombs[idx]) { ms.bombs[idx] = true; placed++; }
                }

                // Create Cells
                for(let i=0; i<ms.rows*ms.cols; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'ms-cell';
                    cell.onmousedown = (e) => {
                        if(ms.gameOver) return;
                        document.getElementById('ms-face-btn').textContent = 'üòÆ';
                        if(e.button === 2) ms.toggleFlag(i);
                        else if(e.button === 0) ms.reveal(i);
                    };
                    cell.onmouseup = () => {
                        if(!ms.gameOver) document.getElementById('ms-face-btn').textContent = 'üôÇ';
                    };
                    ms.grid.appendChild(cell);
                }
                
                // Timer
                if(ms.timerInt) clearInterval(ms.timerInt);
                ms.timer = 0;
                document.getElementById('ms-timer').textContent = '000';
                ms.timerInt = setInterval(()=>{
                    if(!ms.gameOver) {
                        ms.timer++;
                        document.getElementById('ms-timer').textContent = ms.pad(Math.min(999, ms.timer));
                    }
                }, 1000);
            },

            reset: () => {
                if(minesweeper.timerInt) clearInterval(minesweeper.timerInt);
            },

            toggleFlag: (idx) => {
                if(minesweeper.revealed[idx]) return;
                minesweeper.flagged[idx] = !minesweeper.flagged[idx];
                const cell = minesweeper.grid.children[idx];
                cell.textContent = minesweeper.flagged[idx] ? 'üö©' : '';
                // Update count
                let flags = minesweeper.flagged.filter(Boolean).length;
                document.getElementById('ms-bomb-count').textContent = minesweeper.pad(minesweeper.bombCount - flags);
            },

            reveal: (idx) => {
                const ms = minesweeper;
                if(ms.revealed[idx] || ms.flagged[idx]) return;

                ms.revealed[idx] = true;
                const cell = ms.grid.children[idx];
                cell.classList.add('revealed');

                if(ms.bombs[idx]) {
                    // Hit Bomb
                    cell.classList.add('bomb-revealed');
                    cell.textContent = 'üí£';
                    ms.endGame(false);
                } else {
                    // Number or Empty
                    let count = ms.countBombs(idx);
                    if(count > 0) {
                        cell.textContent = count;
                        cell.classList.add('ms-c'+count);
                    } else {
                        // Flood fill
                        ms.getNeighbors(idx).forEach(n => ms.reveal(n));
                    }
                    ms.checkWin();
                }
            },

            countBombs: (idx) => {
                return minesweeper.getNeighbors(idx).filter(n => minesweeper.bombs[n]).length;
            },

            getNeighbors: (idx) => {
                const r = Math.floor(idx / 9), c = idx % 9;
                const n = [];
                for(let dr=-1; dr<=1; dr++) {
                    for(let dc=-1; dc<=1; dc++) {
                        if(dr===0 && dc===0) continue;
                        const nr = r+dr, nc = c+dc;
                        if(nr>=0 && nr<9 && nc>=0 && nc<9) n.push(nr*9 + nc);
                    }
                }
                return n;
            },

            checkWin: () => {
                const ms = minesweeper;
                let safeCells = (ms.rows * ms.cols) - ms.bombCount;
                let revealedCount = ms.revealed.filter(Boolean).length;
                if(revealedCount === safeCells) ms.endGame(true);
            },

            endGame: (won) => {
                minesweeper.gameOver = true;
                clearInterval(minesweeper.timerInt);
                document.getElementById('ms-face-btn').textContent = won ? 'üòé' : 'üòµ';
                if(!won) {
                    // Reveal all bombs
                    minesweeper.bombs.forEach((isBomb, i) => {
                        if(isBomb) {
                            const cell = minesweeper.grid.children[i];
                            cell.textContent = 'üí£';
                            if(!minesweeper.revealed[i]) cell.style.background = '#c0c0c0'; // transparent reveal
                        }
                    });
                }
            },

            pad: (num) => num.toString().padStart(3, '0')
        };

        /* --- CALCULATOR --- */
        const calculator = {
            display: null,
            current: '0',
            previous: null,
            operation: null,
            init: () => {
                calculator.display = document.getElementById('calc-display');
                calculator.current = '0';
                calculator.previous = null;
                calculator.operation = null;
                calculator.updateDisplay();
                calculator.createButtons();
            },
            createButtons: () => {
                const buttons = [
                    ['C', 'clear'], ['/', 'operator'], ['*', 'operator'], ['-', 'operator'],
                    ['7', 'number'], ['8', 'number'], ['9', 'number'], ['+', 'operator'],
                    ['4', 'number'], ['5', 'number'], ['6', 'number'], ['=', 'equals'],
                    ['1', 'number'], ['2', 'number'], ['3', 'number'], ['', ''],
                    ['0', 'number'], ['.', 'number'], ['', ''], ['', '']
                ];
                const container = document.getElementById('calc-buttons');
                container.innerHTML = '';
                buttons.forEach(([label, type]) => {
                    if(!label) return;
                    const btn = document.createElement('button');
                    btn.className = `calc-btn ${type}`;
                    btn.textContent = label;
                    btn.onclick = () => calculator.handleInput(label, type);
                    container.appendChild(btn);
                });
            },
            handleInput: (value, type) => {
                if(type === 'number') {
                    if(calculator.current === '0') calculator.current = value;
                    else calculator.current += value;
                } else if(type === 'operator') {
                    if(calculator.previous !== null) calculator.calculate();
                    calculator.previous = calculator.current;
                    calculator.operation = value;
                    calculator.current = '0';
                } else if(type === 'equals') {
                    calculator.calculate();
                } else if(type === 'clear') {
                    calculator.current = '0';
                    calculator.previous = null;
                    calculator.operation = null;
                }
                calculator.updateDisplay();
            },
            calculate: () => {
                if(calculator.previous === null || calculator.operation === null) return;
                const prev = parseFloat(calculator.previous);
                const curr = parseFloat(calculator.current);
                let result = 0;
                switch(calculator.operation) {
                    case '+': result = prev + curr; break;
                    case '-': result = prev - curr; break;
                    case '*': result = prev * curr; break;
                    case '/': result = prev / curr; break;
                }
                calculator.current = result.toString();
                calculator.previous = null;
                calculator.operation = null;
            },
            updateDisplay: () => {
                calculator.display.textContent = calculator.current;
            }
        };

        /* --- CLOCK APP --- */
        const clockApp = {
            alarms: [],
            init: () => {
                clockApp.update();
                setInterval(clockApp.update, 1000);
            },
            update: () => {
                const now = new Date();
                const time = now.toLocaleTimeString('ja-JP');
                const date = now.toLocaleDateString('ja-JP', {year:'numeric', month:'long', day:'numeric', weekday:'long'});
                document.getElementById('clock-time-display').textContent = time;
                document.getElementById('clock-date').textContent = date;
                clockApp.checkAlarms(now);
            },
            addAlarm: () => {
                const hour = parseInt(document.getElementById('alarm-hour').value);
                const minute = parseInt(document.getElementById('alarm-minute').value);
                const time = `${hour.toString().padStart(2,'0')}:${minute.toString().padStart(2,'0')}`;
                clockApp.alarms.push({hour, minute, time});
                clockApp.updateAlarmList();
            },
            updateAlarmList: () => {
                const list = document.getElementById('alarm-list');
                list.innerHTML = clockApp.alarms.map((alarm, i) => 
                    `<div style="padding:5px; border-bottom:1px solid #ddd; display:flex; justify-content:space-between;">
                        <span>${alarm.time}</span>
                        <button onclick="clockApp.removeAlarm(${i})" style="padding:2px 8px;">ÂâäÈô§</button>
                    </div>`
                ).join('');
            },
            removeAlarm: (index) => {
                clockApp.alarms.splice(index, 1);
                clockApp.updateAlarmList();
            },
            checkAlarms: (now) => {
                clockApp.alarms.forEach(alarm => {
                    if(now.getHours() === alarm.hour && now.getMinutes() === alarm.minute && now.getSeconds() === 0) {
                        alert(`„Ç¢„É©„Éº„É†: ${alarm.time}`);
                    }
                });
            }
        };

        /* --- PAINT APP --- */
        const paintApp = {
            canvas: null,
            ctx: null,
            isDrawing: false,
            color: '#000000',
            size: 5,
            init: () => {
                paintApp.canvas = document.getElementById('paint-canvas');
                paintApp.ctx = paintApp.canvas.getContext('2d');
                paintApp.ctx.lineCap = 'round';
                paintApp.ctx.lineJoin = 'round';
                paintApp.canvas.onmousedown = (e) => {
                    paintApp.isDrawing = true;
                    const rect = paintApp.canvas.getBoundingClientRect();
                    paintApp.ctx.beginPath();
                    paintApp.ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
                };
                paintApp.canvas.onmousemove = (e) => {
                    if(!paintApp.isDrawing) return;
                    const rect = paintApp.canvas.getBoundingClientRect();
                    paintApp.ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                    paintApp.ctx.stroke();
                };
                paintApp.canvas.onmouseup = () => paintApp.isDrawing = false;
                paintApp.canvas.onmouseleave = () => paintApp.isDrawing = false;
            },
            setColor: (color) => {
                paintApp.color = color;
                paintApp.ctx.strokeStyle = color;
            },
            setSize: (size) => {
                paintApp.size = parseInt(size);
                paintApp.ctx.lineWidth = paintApp.size;
                document.getElementById('paint-size-display').textContent = paintApp.size + 'px';
            },
            clear: () => {
                paintApp.ctx.clearRect(0, 0, paintApp.canvas.width, paintApp.canvas.height);
            }
        };
        // Initialize paint color and size
        setTimeout(() => {
            if(document.getElementById('paint-color')) {
                paintApp.setColor(document.getElementById('paint-color').value);
                paintApp.setSize(document.getElementById('paint-size').value);
            }
        }, 100);

        /* --- CALENDAR APP --- */
        const calendarApp = {
            currentDate: new Date(),
            init: () => {
                calendarApp.render();
            },
            render: () => {
                const year = calendarApp.currentDate.getFullYear();
                const month = calendarApp.currentDate.getMonth();
                const monthNames = ['1Êúà', '2Êúà', '3Êúà', '4Êúà', '5Êúà', '6Êúà', '7Êúà', '8Êúà', '9Êúà', '10Êúà', '11Êúà', '12Êúà'];
                document.getElementById('calendar-month-year').textContent = `${year}Âπ¥ ${monthNames[month]}`;
                
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const startDate = new Date(firstDay);
                startDate.setDate(startDate.getDate() - startDate.getDay());
                
                const grid = document.getElementById('calendar-grid');
                grid.innerHTML = '';
                
                const dayNames = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
                dayNames.forEach(day => {
                    const header = document.createElement('div');
                    header.className = 'calendar-day-header';
                    header.textContent = day;
                    grid.appendChild(header);
                });
                
                const today = new Date();
                for(let i = 0; i < 42; i++) {
                    const date = new Date(startDate);
                    date.setDate(startDate.getDate() + i);
                    const day = document.createElement('div');
                    day.className = 'calendar-day';
                    day.textContent = date.getDate();
                    if(date.getMonth() !== month) day.classList.add('other-month');
                    if(date.toDateString() === today.toDateString()) day.classList.add('today');
                    grid.appendChild(day);
                }
            },
            prevMonth: () => {
                calendarApp.currentDate.setMonth(calendarApp.currentDate.getMonth() - 1);
                calendarApp.render();
            },
            nextMonth: () => {
                calendarApp.currentDate.setMonth(calendarApp.currentDate.getMonth() + 1);
                calendarApp.render();
            }
        };

        /* --- STOPWATCH APP --- */
        const stopwatchApp = {
            startTime: 0,
            elapsed: 0,
            interval: null,
            laps: [],
            init: () => {
                stopwatchApp.reset();
            },
            start: () => {
                if(stopwatchApp.interval) return;
                stopwatchApp.startTime = Date.now() - stopwatchApp.elapsed;
                stopwatchApp.interval = setInterval(() => {
                    stopwatchApp.elapsed = Date.now() - stopwatchApp.startTime;
                    stopwatchApp.updateDisplay();
                }, 10);
                document.getElementById('stopwatch-start').style.display = 'none';
                document.getElementById('stopwatch-stop').style.display = 'inline-block';
            },
            stop: () => {
                if(stopwatchApp.interval) {
                    clearInterval(stopwatchApp.interval);
                    stopwatchApp.interval = null;
                }
                document.getElementById('stopwatch-start').style.display = 'inline-block';
                document.getElementById('stopwatch-stop').style.display = 'none';
            },
            reset: () => {
                stopwatchApp.stop();
                stopwatchApp.elapsed = 0;
                stopwatchApp.laps = [];
                stopwatchApp.updateDisplay();
                document.getElementById('stopwatch-laps').innerHTML = '';
            },
            lap: () => {
                if(!stopwatchApp.interval) return;
                stopwatchApp.laps.push(stopwatchApp.elapsed);
                const lapList = document.getElementById('stopwatch-laps');
                const lapTime = stopwatchApp.formatTime(stopwatchApp.elapsed);
                lapList.innerHTML = `<div style="padding:5px; border-bottom:1px solid #ddd;">„É©„ÉÉ„Éó ${stopwatchApp.laps.length}: ${lapTime}</div>` + lapList.innerHTML;
            },
            updateDisplay: () => {
                document.getElementById('stopwatch-display').textContent = stopwatchApp.formatTime(stopwatchApp.elapsed);
            },
            formatTime: (ms) => {
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                const centiseconds = Math.floor((ms % 1000) / 10);
                return `${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}:${centiseconds.toString().padStart(2,'0')}`;
            }
        };

    </script>
</body>
</html>