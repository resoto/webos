<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced WebOS</title>
    <style>
        /* --- CSS Variables & Reset --- */
        :root {
            --bg-image: url('https://images.unsplash.com/photo-1477346611705-65d1883cee1e?auto=format&fit=crop&w=1920&q=80');
            --lock-bg: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1920&q=80');
            --primary-color: #0078d7;
            --taskbar-bg: rgba(20, 20, 20, 0.9);
            --window-bg: #ffffff;
            --text-color: #000000;
            --header-bg: #f0f0f0;
        }

        [data-theme="dark"] {
            --window-bg: #2b2b2b;
            --text-color: #ffffff;
            --header-bg: #1f1f1f;
        }

        * { box-sizing: border-box; user-select: none; }
        body { margin: 0; padding: 0; font-family: "Segoe UI", sans-serif; overflow: hidden; height: 100vh; width: 100vw; }
        
        /* --- Screen Layers --- */
        .screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            transition: opacity 0.5s, transform 0.5s;
        }

        /* 1. Boot Screen */
        #boot-screen {
            background-color: #000;
            z-index: 30000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        .loader {
            border: 4px solid #333;
            border-top: 4px solid #fff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* 2. Lock Screen */
        #lock-screen {
            background: var(--lock-bg) no-repeat center center fixed;
            background-size: cover;
            z-index: 20000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        #lock-screen.hidden {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }
        .lock-time { font-size: 80px; font-weight: 100; margin: 0; }
        .lock-date { font-size: 24px; margin-bottom: 40px; }
        .login-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        .avatar { width: 80px; height: 80px; background: #ccc; border-radius: 50%; border: 2px solid white; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; }
        .login-input { padding: 8px 12px; border: none; border-radius: 4px; width: 200px; font-size: 14px; }
        .login-btn { padding: 8px 20px; background: var(--primary-color); color: white; border: none; border-radius: 4px; cursor: pointer; }
        
        /* 3. Desktop */
        #desktop-screen {
            background: var(--bg-image) no-repeat center center fixed;
            background-size: cover;
            z-index: 1;
        }

        /* Desktop Icons */
        .icon-container {
            padding: 10px;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            height: calc(100vh - 45px);
            align-content: flex-start;
        }
        .app-icon {
            width: 84px;
            height: 90px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 5px;
            color: white;
            text-shadow: 1px 1px 3px black;
            border: 1px solid transparent;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        .app-icon:hover { background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); }
        .app-icon span { font-size: 36px; margin-bottom: 5px; }

        /* Windows */
        .window {
            position: absolute;
            background-color: var(--window-bg);
            color: var(--text-color);
            border: 1px solid #555;
            border-radius: 6px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            min-width: 200px; min-height: 150px;
            opacity: 0; transform: scale(0.9);
            transition: opacity 0.2s, transform 0.2s;
            pointer-events: none;
        }
        .window.active { opacity: 1; transform: scale(1); pointer-events: auto; }
        .window.minimized { opacity: 0; transform: translateY(100px) scale(0.5); pointer-events: none; transition: 0.3s; }

        .win-header {
            background: var(--header-bg);
            padding: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #ccc;
            border-radius: 6px 6px 0 0;
        }
        .win-controls button {
            border: none; background: transparent; width: 28px; height: 28px;
            border-radius: 4px; cursor: pointer; font-size: 14px; color: var(--text-color);
        }
        .win-controls button:hover { background: rgba(0,0,0,0.1); }
        .win-controls button.close-btn:hover { background: #e81123; color: white; }
        
        .win-body { flex: 1; overflow: auto; padding: 10px; position: relative; }
        
        /* App Specifics */
        .browser-bar { display: flex; gap: 5px; padding-bottom: 10px; border-bottom: 1px solid #eee; margin-bottom: 10px; }
        .url-input { flex: 1; padding: 4px 10px; border-radius: 15px; border: 1px solid #ccc; background: #f1f1f1; font-size: 13px; }
        
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #eee; }
        
        textarea { width: 100%; height: 100%; border: none; background: transparent; color: var(--text-color); resize: none; outline: none; font-family: monospace; }

        /* Taskbar */
        .taskbar {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 45px;
            background: var(--taskbar-bg);
            display: flex; align-items: center;
            padding: 0 10px;
            backdrop-filter: blur(10px);
            z-index: 10000;
        }
        .start-btn { width: 40px; height: 35px; display: flex; justify-content: center; align-items: center; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        .start-btn:hover { background: rgba(255,255,255,0.1); }
        .task-list { display: flex; flex: 1; gap: 2px; height: 100%; padding: 3px 0; }
        .task-item {
            width: 140px;
            display: flex; align-items: center; padding: 0 10px;
            color: white; font-size: 12px;
            cursor: pointer; border-radius: 3px;
            background: rgba(255,255,255,0.05);
            border-bottom: 2px solid transparent;
        }
        .task-item:hover { background: rgba(255,255,255,0.1); }
        .task-item.focused { background: rgba(255,255,255,0.15); border-bottom: 2px solid var(--primary-color); }
        .tray { display: flex; color: white; font-size: 12px; text-align: center; gap: 15px; padding-right: 10px; }
    </style>
</head>
<body>

    <div id="boot-screen" class="screen">
        <div class="loader"></div>
        <h2>WebOS</h2>
        <p>Starting up...</p>
    </div>

    <div id="lock-screen" class="screen">
        <div class="lock-time" id="lock-clock">12:00</div>
        <div class="lock-date" id="lock-date">1Êúà1Êó• ÊúàÊõúÊó•</div>
        <div class="login-box">
            <div class="avatar">üë§</div>
            <div style="font-size:18px; margin-bottom: 5px;">Admin User</div>
            <input type="password" class="login-input" id="password-input" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ (ÂÖ•Âäõ‰∏çË¶Å)" onkeydown="checkLogin(event)">
            <button class="login-btn" onclick="unlock()">„É≠„Ç∞„Ç§„É≥</button>
        </div>
    </div>

    <div id="desktop-screen" class="screen">
        <div class="icon-container">
            <div class="app-icon" onclick="openWindow('notepad')"><span>üìù</span>„É°„É¢Â∏≥</div>
            <div class="app-icon" onclick="openWindow('browser')"><span>üåê</span>„Éñ„É©„Ç¶„Ç∂</div>
            <div class="app-icon" onclick="openWindow('settings')"><span>‚öôÔ∏è</span>Ë®≠ÂÆö</div>
            <div class="app-icon" onclick="openWindow('calc')"><span>üßÆ</span>ÈõªÂçì</div>
            <div class="app-icon" onclick="alert('„Ç¥„ÉüÁÆ±„ÅØÁ©∫„Åß„Åô„ÄÇ')"><span>üóëÔ∏è</span>„Ç¥„ÉüÁÆ±</div>
        </div>

        <div id="win-notepad" class="window" style="top: 50px; left: 50px; width: 400px; height: 300px;" data-title="„É°„É¢Â∏≥">
            <div class="win-header" onmousedown="dragStart(event, 'win-notepad')">
                <span>ÁÑ°È°å - „É°„É¢Â∏≥</span>
                <div class="win-controls">
                    <button onclick="minimizeWindow('win-notepad')">_</button>
                    <button class="close-btn" onclick="closeWindow('win-notepad')">√ó</button>
                </div>
            </div>
            <div class="win-body">
                <textarea placeholder="„Åì„Åì„Å´ÂÖ•Âäõ..."></textarea>
            </div>
        </div>

        <div id="win-browser" class="window" style="top: 80px; left: 100px; width: 600px; height: 450px;" data-title="„Éñ„É©„Ç¶„Ç∂">
            <div class="win-header" onmousedown="dragStart(event, 'win-browser')">
                <span>Web Browser</span>
                <div class="win-controls">
                    <button onclick="minimizeWindow('win-browser')">_</button>
                    <button class="close-btn" onclick="closeWindow('win-browser')">√ó</button>
                </div>
            </div>
            <div class="win-body" style="display: flex; flex-direction: column;">
                <div class="browser-bar">
                    <button>‚¨Ö</button><button>‚û°</button><button>‚Üª</button>
                    <input type="text" class="url-input" value="https://welcome.webos.net" readonly>
                </div>
                <div style="flex:1; background: #fff; border: 1px solid #ccc; padding: 20px; color: #333;">
                    <h1>Welcome to WebOS Browser</h1>
                    <p>„Åì„Çå„ÅØ„Ç∑„Éü„É•„É¨„Éº„Ç∑„Éß„É≥Áî®„ÅÆÊì¨‰ºº„Éñ„É©„Ç¶„Ç∂„Åß„Åô„ÄÇ</p>
                    <hr>
                    <h3>News</h3>
                    <ul>
                        <li>WebOS v2.0„Åå„É™„É™„Éº„Çπ„Åï„Çå„Åæ„Åó„Åü„ÄÇ</li>
                        <li>Êñ∞„Åó„ÅÑ„É≠„ÉÉ„ÇØÁîªÈù¢Ê©üËÉΩ„ÅåËøΩÂä†„Åï„Çå„Åæ„Åó„Åü„ÄÇ</li>
                        <li>„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ„Å´ÂØæÂøú„Åó„Åæ„Åó„Åü„ÄÇ</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="win-settings" class="window" style="top: 120px; left: 200px; width: 350px; height: 400px;" data-title="Ë®≠ÂÆö">
            <div class="win-header" onmousedown="dragStart(event, 'win-settings')">
                <span>Ë®≠ÂÆö</span>
                <div class="win-controls">
                    <button onclick="minimizeWindow('win-settings')">_</button>
                    <button class="close-btn" onclick="closeWindow('win-settings')">√ó</button>
                </div>
            </div>
            <div class="win-body">
                <h3>„Ç∑„Çπ„ÉÜ„É†Ë®≠ÂÆö</h3>
                <div class="setting-row">
                    <span>„ÉÄ„Éº„ÇØ„É¢„Éº„Éâ</span>
                    <input type="checkbox" onchange="toggleTheme(this)">
                </div>
                <div class="setting-row">
                    <span>„Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóÂ£ÅÁ¥ô</span>
                    <select onchange="changeWallpaper(this)">
                        <option value="landscape">Â±±Â≤≥ („Éá„Éï„Ç©„É´„Éà)</option>
                        <option value="city">ÈÉΩÂ∏Ç„ÅÆÂ§úÊôØ</option>
                        <option value="abstract">ÊäΩË±°Áîª</option>
                    </select>
                </div>
                <div class="setting-row">
                    <span>„Éê„Éº„Ç∏„Éß„É≥ÊÉÖÂ†±</span>
                    <span style="color: #888;">v2.0.0</span>
                </div>
                <br>
                <button style="width:100%; padding:10px; background:#e81123; color:white; border:none; border-radius:4px; cursor:pointer;" onclick="location.reload()">„Ç∑„É£„ÉÉ„Éà„ÉÄ„Ç¶„É≥ (ÂÜçËµ∑Âãï)</button>
            </div>
        </div>
        
        <div id="win-calc" class="window" style="top: 150px; left: 300px; width: 220px; height: 300px;" data-title="ÈõªÂçì">
            <div class="win-header" onmousedown="dragStart(event, 'win-calc')">
                <span>ÈõªÂçì</span>
                <div class="win-controls">
                    <button onclick="minimizeWindow('win-calc')">_</button>
                    <button class="close-btn" onclick="closeWindow('win-calc')">√ó</button>
                </div>
            </div>
            <div class="win-body" style="display:flex; flex-direction:column; gap:5px;">
                <div id="calc-display" style="background:#eee; color:#333; padding:10px; text-align:right; font-size:20px; margin-bottom:5px; border-radius:4px;">0</div>
                <div style="display:grid; grid-template-columns:repeat(4, 1fr); gap:5px; flex:1;">
                    <button onclick="calc('7')">7</button><button onclick="calc('8')">8</button><button onclick="calc('9')">9</button><button onclick="calc('/')">√∑</button>
                    <button onclick="calc('4')">4</button><button onclick="calc('5')">5</button><button onclick="calc('6')">6</button><button onclick="calc('*')">√ó</button>
                    <button onclick="calc('1')">1</button><button onclick="calc('2')">2</button><button onclick="calc('3')">3</button><button onclick="calc('-')">-</button>
                    <button onclick="calc('C')" style="background:#ffcccc">C</button><button onclick="calc('0')">0</button><button onclick="calc('=')">=</button><button onclick="calc('+')">+</button>
                </div>
            </div>
        </div>

        <div class="taskbar">
            <div class="start-btn" onclick="toggleStartMenu()">
                <div style="font-size: 22px; color: white;">‚ùñ</div>
            </div>
            <div class="task-list" id="task-list">
                </div>
            <div class="tray">
                <span id="tray-wifi">üì∂</span>
                <span id="tray-audio">üîä</span>
                <span id="tray-clock">00:00</span>
            </div>
        </div>
    </div>

    <script>
        /* --- System Logic --- */
        
        // Boot Sequence
        window.onload = function() {
            setTimeout(() => {
                document.getElementById('boot-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    updateClock(); // Start clock immediately
                }, 500);
            }, 2000); // 2 seconds boot time
        };

        // Lock Screen Logic
        function updateClock() {
            const now = new Date();
            
            // For Lock Screen
            const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            const dateStr = now.toLocaleDateString('ja-JP', { month: 'long', day: 'numeric', weekday: 'long' });
            document.getElementById('lock-clock').innerText = timeStr;
            document.getElementById('lock-date').innerText = dateStr;
            
            // For Taskbar
            document.getElementById('tray-clock').innerText = timeStr;
        }
        setInterval(updateClock, 1000);

        function checkLogin(e) {
            if (e.key === 'Enter') unlock();
        }

        function unlock() {
            const lockScreen = document.getElementById('lock-screen');
            lockScreen.classList.add('hidden');
            // Play startup sound effect here if desired
        }

        /* --- Window Management --- */
        let zIndex = 100;
        let activeWindows = {}; // Store state

        function openWindow(appId) {
            const winId = 'win-' + appId;
            const win = document.getElementById(winId);
            
            if (!win) return;
            
            // Bring to front & Show
            win.style.display = 'flex'; // Ensure it's visible in DOM
            setTimeout(() => {
                win.classList.remove('minimized');
                win.classList.add('active');
            }, 10);
            
            moveFront(win);
            addToTaskbar(winId, win.getAttribute('data-title'));
        }

        function closeWindow(winId) {
            const win = document.getElementById(winId);
            win.classList.remove('active');
            setTimeout(() => { win.style.display = 'none'; }, 200); // Wait for anim
            removeFromTaskbar(winId);
        }

        function minimizeWindow(winId) {
            const win = document.getElementById(winId);
            win.classList.add('minimized');
            win.classList.remove('active');
            updateTaskbarHighlight(null);
        }

        function moveFront(win) {
            zIndex++;
            win.style.zIndex = zIndex;
            
            // Update Visuals
            document.querySelectorAll('.window').forEach(w => w.style.borderColor = '#555');
            win.style.borderColor = '#0078d7';
            
            updateTaskbarHighlight(win.id);
        }

        /* --- Taskbar Logic --- */
        function addToTaskbar(winId, title) {
            const list = document.getElementById('task-list');
            if (document.getElementById('task-' + winId)) return; // Already exists

            const item = document.createElement('div');
            item.className = 'task-item';
            item.id = 'task-' + winId;
            item.innerHTML = `<span>${title}</span>`;
            item.onclick = () => toggleWindowFromTaskbar(winId);
            list.appendChild(item);
            updateTaskbarHighlight(winId);
        }

        function removeFromTaskbar(winId) {
            const item = document.getElementById('task-' + winId);
            if (item) item.remove();
        }

        function toggleWindowFromTaskbar(winId) {
            const win = document.getElementById(winId);
            if (win.classList.contains('minimized') || win.style.zIndex != zIndex) {
                win.classList.remove('minimized');
                moveFront(win);
            } else {
                minimizeWindow(winId);
            }
        }

        function updateTaskbarHighlight(activeWinId) {
            document.querySelectorAll('.task-item').forEach(item => item.classList.remove('focused'));
            if (activeWinId) {
                const item = document.getElementById('task-' + activeWinId);
                if (item) item.classList.add('focused');
            }
        }

        /* --- Drag Logic --- */
        let isDragging = false;
        let currentDragWin = null;
        let offset = {x:0, y:0};

        function dragStart(e, winId) {
            isDragging = true;
            currentDragWin = document.getElementById(winId);
            moveFront(currentDragWin);
            const rect = currentDragWin.getBoundingClientRect();
            offset.x = e.clientX - rect.left;
            offset.y = e.clientY - rect.top;
        }

        document.addEventListener('mousemove', e => {
            if (!isDragging || !currentDragWin) return;
            e.preventDefault();
            let x = e.clientX - offset.x;
            let y = e.clientY - offset.y;
            
            // Boundaries (simple)
            if (y < 0) y = 0;
            
            currentDragWin.style.left = x + 'px';
            currentDragWin.style.top = y + 'px';
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            currentDragWin = null;
        });

        // Allow clicking window body to focus
        document.querySelectorAll('.window').forEach(win => {
            win.addEventListener('mousedown', () => moveFront(win));
        });

        /* --- App Functions --- */
        // Settings
        function toggleTheme(checkbox) {
            if (checkbox.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
            }
        }

        function changeWallpaper(select) {
            const urls = {
                landscape: 'url("https://images.unsplash.com/photo-1477346611705-65d1883cee1e?auto=format&fit=crop&w=1920&q=80")',
                city: 'url("https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?auto=format&fit=crop&w=1920&q=80")',
                abstract: 'url("https://images.unsplash.com/photo-1541701494587-cb58502866ab?auto=format&fit=crop&w=1920&q=80")'
            };
            document.documentElement.style.setProperty('--bg-image', urls[select.value]);
        }

        // Calc
        let calcExp = "";
        function calc(val) {
            const display = document.getElementById('calc-display');
            if (val === 'C') {
                calcExp = "";
                display.innerText = "0";
            } else if (val === '=') {
                try { display.innerText = eval(calcExp); calcExp = display.innerText; }
                catch { display.innerText = "Error"; calcExp = ""; }
            } else {
                calcExp += val;
                display.innerText = calcExp;
            }
        }
    </script>
</body>
</html>