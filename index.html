<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebOS v5.0 - Minesweeper Edition</title>
    <style>
        /* --- Reset & Variables --- */
        :root {
            --bg-image: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1920&q=80');
            --window-bg: #c0c0c0; /* Classic Gray */
            --header-bg: #000080; /* Classic Blue Title */
            --header-text: white;
            --taskbar-height: 40px;
        }
        * { box-sizing: border-box; user-select: none; }
        body { margin: 0; padding: 0; font-family: "Tahoma", "Segoe UI", sans-serif; overflow: hidden; height: 100vh; width: 100vw; background: #000; }

        /* --- Layers --- */
        .layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: 0.5s; }
        
        /* Boot Screen */
        #boot-screen {
            background: black; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white;
        }
        .spinner {
            width: 50px; height: 50px; border: 5px solid #333; border-top: 5px solid #0078d7; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Lock Screen */
        #lock-screen {
            background: var(--bg-image) center/cover no-repeat; z-index: 20000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        #lock-screen.unlocked { transform: translateY(-100%); }
        .time-large { font-size: 6rem; font-weight: 300; margin: 0; }
        .login-btn { padding: 10px 40px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(10px); cursor: pointer; border-radius: 30px; font-size: 1rem; }

        /* Desktop */
        #desktop { background: var(--bg-image) center/cover no-repeat; z-index: 1; overflow: hidden; }
        
        .desktop-icons {
            padding: 10px; display: flex; flex-direction: column; flex-wrap: wrap; height: calc(100% - var(--taskbar-height)); align-content: flex-start;
        }
        .icon {
            width: 86px; padding: 10px 5px; margin: 5px; text-align: center; color: white; text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
            border-radius: 4px; cursor: pointer; border: 1px solid transparent; transition: 0.1s;
        }
        .icon:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.3); }
        .icon-emoji { font-size: 2.5rem; display: block; margin-bottom: 5px; }

        /* Windows (Retro Style) */
        .window {
            position: absolute; background: var(--window-bg); 
            border: 2px solid; border-color: #dfdfdf #404040 #404040 #dfdfdf;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5); display: flex; flex-direction: column;
            min-width: 200px; min-height: 150px; overflow: hidden;
            opacity: 0; transform: scale(0.95); transition: opacity 0.1s, transform 0.1s;
            pointer-events: none; 
        }
        .window.active { opacity: 1; transform: scale(1); pointer-events: auto; }
        .window.minimized { opacity: 0; transform: translateY(200px) scale(0.5); pointer-events: none; }

        .win-header {
            background: var(--header-bg); color: var(--header-text);
            padding: 2px 4px; height: 28px; display: flex; align-items: center; justify-content: space-between;
            font-weight: bold; font-size: 13px;
        }
        .win-actions { display: flex; gap: 2px; }
        .win-btn { 
            width: 20px; height: 20px; border: 1px solid; border-color: #dfdfdf #404040 #404040 #dfdfdf;
            background: #c0c0c0; font-size: 12px; line-height: 1; display: flex; align-items: center; justify-content: center;
            cursor: pointer;
        }
        .win-btn:active { border-color: #404040 #dfdfdf #dfdfdf #404040; }
        .win-btn.close { font-family: monospace; font-weight: bold; }

        .win-content { flex: 1; position: relative; background: white; overflow: hidden; }

        /* Minesweeper Styles */
        .ms-outer { background: #c0c0c0; padding: 10px; height: 100%; display: flex; flex-direction: column; align-items: center; }
        .ms-header {
            border: 2px solid; border-color: #808080 #fff #fff #808080;
            width: 100%; padding: 5px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; background: #c0c0c0;
        }
        .ms-counter {
            background: black; color: red; font-family: "Courier New", monospace; font-size: 20px; font-weight: bold;
            padding: 0 2px; border: 1px solid #808080; width: 40px; text-align: center;
        }
        .ms-face {
            width: 26px; height: 26px; font-size: 18px; cursor: pointer;
            border: 2px solid; border-color: #fff #808080 #808080 #fff; background: #c0c0c0;
            display: flex; align-items: center; justify-content: center; padding-bottom: 2px;
        }
        .ms-face:active { border-color: #808080 #fff #fff #808080; padding-top: 2px; padding-bottom: 0; }
        
        .ms-grid {
            display: grid; grid-template-columns: repeat(9, 25px); grid-template-rows: repeat(9, 25px);
            border: 3px solid; border-color: #808080 #fff #fff #808080;
        }
        .ms-cell {
            width: 25px; height: 25px; background: #c0c0c0;
            border: 2px solid; border-color: #fff #808080 #808080 #fff;
            font-weight: bold; font-size: 14px; display: flex; align-items: center; justify-content: center;
            cursor: default;
        }
        .ms-cell.revealed {
            border: 1px solid #808080; background: #c0c0c0;
        }
        .ms-cell.bomb-revealed { background: red; border: 1px solid #808080; }
        
        /* Numbers Colors */
        .ms-c1 { color: blue; } .ms-c2 { color: green; } .ms-c3 { color: red; } .ms-c4 { color: navy; }
        .ms-c5 { color: maroon; } .ms-c6 { color: teal; } .ms-c7 { color: black; } .ms-c8 { color: gray; }

        /* Browser Iframe */
        .browser-nav { display: flex; gap: 5px; padding: 5px; background: #c0c0c0; border-bottom: 1px solid #888; }
        .iframe-blocker { position: absolute; top:0; left:0; width:100%; height:100%; display: none; }

        /* Taskbar */
        #taskbar {
            position: absolute; bottom: 0; left: 0; width: 100%; height: var(--taskbar-height);
            background: #c0c0c0; border-top: 2px solid #fff;
            display: flex; align-items: center; padding: 2px; z-index: 10000;
        }
        .start-btn {
            height: 32px; padding: 0 10px; display: flex; align-items: center; gap: 5px;
            border: 2px solid; border-color: #fff #404040 #404040 #fff;
            font-weight: bold; font-style: italic; cursor: pointer; margin-right: 5px;
        }
        .start-btn:active { border-color: #404040 #fff #fff #404040; transform: translateY(1px); }
        
        .task-container { flex: 1; display: flex; gap: 2px; padding-left: 5px; }
        .task-item {
            width: 150px; background: #c0c0c0; border: 2px solid; border-color: #fff #404040 #404040 #fff;
            padding: 4px 8px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 5px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .task-item.active-task {
            background: #e0e0e0; border-color: #404040 #fff #fff #404040; background-image: linear-gradient(45deg, #ddd 25%, transparent 25%, transparent 50%, #ddd 50%, #ddd 75%, transparent 75%, transparent); background-size: 4px 4px;
        }

        .sys-tray { margin-left: auto; padding: 0 10px; font-size: 12px; border: 2px solid; border-color: #808080 #fff #fff #808080; background: #c0c0c0; height: 30px; display: flex; align-items: center; }

        /* Start Menu */
        #start-menu {
            position: fixed; bottom: 42px; left: 2px; width: 200px; background: #c0c0c0;
            border: 2px solid; border-color: #fff #404040 #404040 #fff; padding: 2px; z-index: 10001;
            display: none; flex-direction: column;
        }
        #start-menu.open { display: flex; }
        .menu-row { padding: 10px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .menu-row:hover { background: #000080; color: white; }
    </style>
</head>
<body>

    <div id="boot-screen" class="layer">
        <div class="spinner"></div>
        <h2>WebOS v5.0</h2>
        <p>Minesweeper Edition</p>
    </div>

    <div id="lock-screen" class="layer" style="display:none;">
        <div class="time-large" id="lock-time">12:00</div>
        <button class="login-btn" onclick="unlockSystem()">Click to Login</button>
    </div>

    <div id="desktop" class="layer" style="display:none;">
        
        <div class="desktop-icons">
            <div class="icon" onclick="app.open('game')">
                <span class="icon-emoji">üí£</span>
                <span>„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë</span>
            </div>
            <div class="icon" onclick="app.open('browser')">
                <span class="icon-emoji">üåê</span>
                <span>„Éñ„É©„Ç¶„Ç∂</span>
            </div>
            <div class="icon" onclick="app.open('notepad')">
                <span class="icon-emoji">üìù</span>
                <span>„É°„É¢Â∏≥</span>
            </div>
            <div class="icon" onclick="app.open('settings')">
                <span class="icon-emoji">‚öôÔ∏è</span>
                <span>Ë®≠ÂÆö</span>
            </div>
        </div>

        <div id="win-game" class="window" style="width: 280px; height: 360px; top: 50px; left: 150px;" data-title="„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-game')">
                <span>„Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-game')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-game')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <div class="ms-outer" oncontextmenu="return false;">
                    <div class="ms-header">
                        <div class="ms-counter" id="ms-bomb-count">010</div>
                        <button class="ms-face" id="ms-face-btn" onclick="minesweeper.init()">üôÇ</button>
                        <div class="ms-counter" id="ms-timer">000</div>
                    </div>
                    <div id="ms-grid" class="ms-grid"></div>
                </div>
            </div>
        </div>

        <div id="win-browser" class="window" style="width: 800px; height: 600px; top: 30px; left: 30px;" data-title="„Éñ„É©„Ç¶„Ç∂">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-browser')">
                <span>Web Browser</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-browser')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-browser')">√ó</button>
                </div>
            </div>
            <div class="win-content" style="display:flex; flex-direction:column;">
                <div class="browser-nav">
                    <input type="text" id="browser-url" style="flex:1;" value="https://ja.m.wikipedia.org/wiki/Main_Page" onkeydown="if(event.key==='Enter') browser.go()">
                    <button onclick="browser.go()">Go</button>
                </div>
                <div style="flex:1; position:relative;">
                    <div class="iframe-blocker" id="browser-blocker"></div>
                    <iframe id="browser-frame" src="about:blank" style="width:100%; height:100%; border:none;"></iframe>
                </div>
            </div>
        </div>

        <div id="win-notepad" class="window" style="width: 300px; height: 200px; top: 100px; left: 100px;" data-title="„É°„É¢Â∏≥">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-notepad')">
                <span>ÁÑ°È°å - „É°„É¢Â∏≥</span>
                <div class="win-actions">
                    <button class="win-btn" onclick="wm.minimize('win-notepad')">_</button>
                    <button class="win-btn close" onclick="wm.close('win-notepad')">√ó</button>
                </div>
            </div>
            <div class="win-content">
                <textarea style="width:100%; height:100%; resize:none; border:none; padding:5px;"></textarea>
            </div>
        </div>

        <div id="win-settings" class="window" style="width: 250px; height: 200px; top: 150px; left: 200px;" data-title="Ë®≠ÂÆö">
            <div class="win-header" onmousedown="wm.startDrag(event, 'win-settings')">
                <span>Ë®≠ÂÆö</span>
                <div class="win-actions"><button class="win-btn close" onclick="wm.close('win-settings')">√ó</button></div>
            </div>
            <div class="win-content" style="padding:10px;">
                <p>ËÉåÊôØË®≠ÂÆö:</p>
                <button onclick="document.documentElement.style.setProperty('--bg-image', 'url(https://images.unsplash.com/photo-1477346611705-65d1883cee1e?auto=format&fit=crop&w=1920)')">Â±±</button>
                <button onclick="document.documentElement.style.setProperty('--bg-image', 'url(https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?auto=format&fit=crop&w=1920)')">ÈÉΩÂ∏Ç</button>
            </div>
        </div>

        <div id="taskbar">
            <div class="start-btn" onclick="sys.toggleStart()">
                <span style="color:red; font-weight:900;">‚ùñ</span> Start
            </div>
            <div class="task-container" id="task-list"></div>
            <div class="sys-tray">
                <span id="clock">00:00</span>
            </div>
        </div>

        <div id="start-menu">
            <div class="menu-row" onclick="app.open('game'); sys.toggleStart()">üí£ „Éû„Ç§„É≥„Çπ„Ç§„Éº„Éë</div>
            <div class="menu-row" onclick="app.open('browser'); sys.toggleStart()">üåê „Éñ„É©„Ç¶„Ç∂</div>
            <div class="menu-row" onclick="app.open('notepad'); sys.toggleStart()">üìù „É°„É¢Â∏≥</div>
            <div style="height:1px; background:#808080; margin:5px 0;"></div>
            <div class="menu-row" onclick="sys.shutdown()">‚èª „Ç∑„É£„ÉÉ„Éà„ÉÄ„Ç¶„É≥</div>
        </div>

    </div>

    <script>
        /* --- SYSTEM --- */
        const sys = {
            boot: () => {
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    document.getElementById('lock-screen').style.display = 'flex';
                    sys.updateClock();
                }, 1500);
            },
            updateClock: () => {
                const now = new Date();
                const t = now.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
                document.getElementById('clock').textContent = t;
                document.getElementById('lock-time').textContent = t;
            },
            toggleStart: () => document.getElementById('start-menu').classList.toggle('open'),
            shutdown: () => {
                document.getElementById('desktop').style.filter='grayscale(1)';
                setTimeout(()=>location.reload(), 1000);
            }
        };
        setInterval(sys.updateClock, 1000);
        window.onload = sys.boot;
        function unlockSystem() {
            document.getElementById('lock-screen').classList.add('unlocked');
            document.getElementById('desktop').style.display = 'block';
        }

        /* --- WM --- */
        let zIndex = 100;
        const wm = {
            open: (id) => {
                const w = document.getElementById(id);
                w.classList.remove('minimized'); w.classList.add('active');
                wm.toFront(w);
                taskbar.add(id, w.dataset.title);
            },
            close: (id) => {
                document.getElementById(id).classList.remove('active');
                taskbar.remove(id);
                if(id==='win-game') minesweeper.reset();
            },
            minimize: (id) => {
                document.getElementById(id).classList.add('minimized');
                document.getElementById(id).classList.remove('active');
                taskbar.update(null);
            },
            toFront: (w) => {
                w.style.zIndex = ++zIndex;
                taskbar.update(w.id);
            },
            startDrag: (e, id) => {
                if(e.target.classList.contains('win-btn')) return;
                const w = document.getElementById(id);
                wm.toFront(w);
                if(id === 'win-browser') document.getElementById('browser-blocker').style.display='block';
                
                const r = w.getBoundingClientRect();
                const offX = e.clientX - r.left, offY = e.clientY - r.top;
                
                const move = (ev) => {
                    w.style.left = (ev.clientX - offX) + 'px';
                    w.style.top = Math.max(0, ev.clientY - offY) + 'px';
                };
                const stop = () => {
                    document.removeEventListener('mousemove', move);
                    document.removeEventListener('mouseup', stop);
                    if(id === 'win-browser') document.getElementById('browser-blocker').style.display='none';
                };
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', stop);
            }
        };
        document.querySelectorAll('.window').forEach(w=>w.addEventListener('mousedown',()=>wm.toFront(w)));

        /* --- TASKBAR --- */
        const taskbar = {
            add: (id, title) => {
                if(document.getElementById('task-'+id)) return;
                const el = document.createElement('div');
                el.id = 'task-'+id; el.className='task-item active-task';
                el.innerHTML = (id==='win-game'?'üí£ ':id==='win-browser'?'üåê ':'üìù ') + title;
                el.onclick = () => {
                    const w = document.getElementById(id);
                    if(w.classList.contains('active') && w.style.zIndex==zIndex) wm.minimize(id);
                    else wm.open(id);
                };
                document.getElementById('task-list').appendChild(el);
            },
            remove: (id) => { const el = document.getElementById('task-'+id); if(el) el.remove(); },
            update: (id) => {
                document.querySelectorAll('.task-item').forEach(t => t.classList.remove('active-task'));
                if(id) document.getElementById('task-'+id)?.classList.add('active-task');
            }
        };

        /* --- APPS --- */
        const app = {
            open: (name) => {
                wm.open('win-'+name);
                if(name==='browser') browser.init();
                if(name==='game') minesweeper.init();
            }
        };
        const browser = {
            init: () => {
                const f = document.getElementById('browser-frame');
                if(f.src==='about:blank') f.src="https://ja.m.wikipedia.org/wiki/Main_Page";
            },
            go: () => {
                let u = document.getElementById('browser-url').value;
                if(!u.startsWith('http')) u = 'https://ja.m.wikipedia.org/w/index.php?search='+encodeURIComponent(u);
                document.getElementById('browser-frame').src = u;
            }
        };

        /* --- MINESWEEPER LOGIC --- */
        const minesweeper = {
            rows: 9, cols: 9, bombCount: 10,
            grid: [], bombs: [], revealed: [], flagged: [],
            gameOver: false, timer: 0, timerInt: null,

            init: () => {
                const ms = minesweeper;
                ms.gameOver = false;
                ms.grid = document.getElementById('ms-grid');
                ms.grid.innerHTML = '';
                ms.bombs = Array(ms.rows * ms.cols).fill(false);
                ms.revealed = Array(ms.rows * ms.cols).fill(false);
                ms.flagged = Array(ms.rows * ms.cols).fill(false);
                document.getElementById('ms-face-btn').textContent = 'üôÇ';
                document.getElementById('ms-bomb-count').textContent = ms.pad(ms.bombCount);
                
                // Place bombs
                let placed = 0;
                while(placed < ms.bombCount) {
                    let idx = Math.floor(Math.random() * (ms.rows * ms.cols));
                    if(!ms.bombs[idx]) { ms.bombs[idx] = true; placed++; }
                }

                // Create Cells
                for(let i=0; i<ms.rows*ms.cols; i++) {
                    const cell = document.createElement('div');
                    cell.className = 'ms-cell';
                    cell.onmousedown = (e) => {
                        if(ms.gameOver) return;
                        document.getElementById('ms-face-btn').textContent = 'üòÆ';
                        if(e.button === 2) ms.toggleFlag(i);
                        else if(e.button === 0) ms.reveal(i);
                    };
                    cell.onmouseup = () => {
                        if(!ms.gameOver) document.getElementById('ms-face-btn').textContent = 'üôÇ';
                    };
                    ms.grid.appendChild(cell);
                }
                
                // Timer
                if(ms.timerInt) clearInterval(ms.timerInt);
                ms.timer = 0;
                document.getElementById('ms-timer').textContent = '000';
                ms.timerInt = setInterval(()=>{
                    if(!ms.gameOver) {
                        ms.timer++;
                        document.getElementById('ms-timer').textContent = ms.pad(Math.min(999, ms.timer));
                    }
                }, 1000);
            },

            reset: () => {
                if(minesweeper.timerInt) clearInterval(minesweeper.timerInt);
            },

            toggleFlag: (idx) => {
                if(minesweeper.revealed[idx]) return;
                minesweeper.flagged[idx] = !minesweeper.flagged[idx];
                const cell = minesweeper.grid.children[idx];
                cell.textContent = minesweeper.flagged[idx] ? 'üö©' : '';
                // Update count
                let flags = minesweeper.flagged.filter(Boolean).length;
                document.getElementById('ms-bomb-count').textContent = minesweeper.pad(minesweeper.bombCount - flags);
            },

            reveal: (idx) => {
                const ms = minesweeper;
                if(ms.revealed[idx] || ms.flagged[idx]) return;

                ms.revealed[idx] = true;
                const cell = ms.grid.children[idx];
                cell.classList.add('revealed');

                if(ms.bombs[idx]) {
                    // Hit Bomb
                    cell.classList.add('bomb-revealed');
                    cell.textContent = 'üí£';
                    ms.endGame(false);
                } else {
                    // Number or Empty
                    let count = ms.countBombs(idx);
                    if(count > 0) {
                        cell.textContent = count;
                        cell.classList.add('ms-c'+count);
                    } else {
                        // Flood fill
                        ms.getNeighbors(idx).forEach(n => ms.reveal(n));
                    }
                    ms.checkWin();
                }
            },

            countBombs: (idx) => {
                return minesweeper.getNeighbors(idx).filter(n => minesweeper.bombs[n]).length;
            },

            getNeighbors: (idx) => {
                const r = Math.floor(idx / 9), c = idx % 9;
                const n = [];
                for(let dr=-1; dr<=1; dr++) {
                    for(let dc=-1; dc<=1; dc++) {
                        if(dr===0 && dc===0) continue;
                        const nr = r+dr, nc = c+dc;
                        if(nr>=0 && nr<9 && nc>=0 && nc<9) n.push(nr*9 + nc);
                    }
                }
                return n;
            },

            checkWin: () => {
                const ms = minesweeper;
                let safeCells = (ms.rows * ms.cols) - ms.bombCount;
                let revealedCount = ms.revealed.filter(Boolean).length;
                if(revealedCount === safeCells) ms.endGame(true);
            },

            endGame: (won) => {
                minesweeper.gameOver = true;
                clearInterval(minesweeper.timerInt);
                document.getElementById('ms-face-btn').textContent = won ? 'üòé' : 'üòµ';
                if(!won) {
                    // Reveal all bombs
                    minesweeper.bombs.forEach((isBomb, i) => {
                        if(isBomb) {
                            const cell = minesweeper.grid.children[i];
                            cell.textContent = 'üí£';
                            if(!minesweeper.revealed[i]) cell.style.background = '#c0c0c0'; // transparent reveal
                        }
                    });
                }
            },

            pad: (num) => num.toString().padStart(3, '0')
        };

    </script>
</body>
</html>